import{f as e,o as t,j as a,a as s,s as r,b as l,d}from"./index-CyZx3RiQ.js";import{r as i}from"./vendor-Cg3t72uT.js";import{A as n,O as o,P as c,Q as x}from"./firebase-DOVT3bkn.js";import"./utils-CrM1Z76V.js";const m=({showOnlyLogin:m=!1,onLoginSuccess:g})=>{const[h,u]=i.useState(null),[b,p]=i.useState([]),[y,w]=i.useState(null),[j,f]=i.useState(""),[N,k]=i.useState(""),[v,L]=i.useState(""),[M,U]=i.useState(!1),[B,D]=i.useState(e.getFormattedUsage()),[S,F]=i.useState(!1),[C,T]=i.useState("month");i.useEffect(()=>{const t=setInterval(()=>{D(e.getFormattedUsage())},5e3);return()=>clearInterval(t)},[]);const R=()=>{window.confirm("Are you sure you want to reset all usage data?")&&(e.resetUsage(),D(e.getFormattedUsage()))},E=()=>a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Firebase Usage Monitor"}),a.jsx("button",{onClick:()=>F(!S),className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:S?"Collapse":"Expand"})]}),a.jsx("div",{className:"flex gap-2 mb-4",children:["day","week","month"].map(e=>a.jsx("button",{className:"px-3 py-1 rounded-full text-sm font-medium border transition-colors "+(C===e?"bg-blue-600 text-white border-blue-700":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 border-gray-300 dark:border-gray-600"),onClick:()=>T(e),children:"day"===e?"Today":"week"===e?"This Week":"This Month"},e))}),(()=>{const e=new Date;let t={reads:0,writes:0,bandwidth:0},s="";if("day"===C){const a=e.toDateString(),r=B.dailyUsage.find(e=>e.date===a);r&&(t=r),s="Today"}else if("week"===C){const a=new Date(e);a.setDate(e.getDate()-e.getDay()),B.dailyUsage.forEach(e=>{new Date(e.date)>=a&&(t.reads+=e.reads,t.writes+=e.writes,t.bandwidth+=e.bandwidth)}),s="This Week"}else{const a=new Date(e.getFullYear(),e.getMonth(),1);B.dailyUsage.forEach(e=>{new Date(e.date)>=a&&(t.reads+=e.reads,t.writes+=e.writes,t.bandwidth+=e.bandwidth)}),s="This Month"}return a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[a.jsxs("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-3 rounded-lg",children:[a.jsxs("div",{className:"text-xs text-blue-900 dark:text-blue-100",children:["Reads (",s,")"]}),a.jsx("div",{className:"text-lg font-semibold text-blue-700 dark:text-blue-200",children:t.reads.toLocaleString()})]}),a.jsxs("div",{className:"bg-green-100 dark:bg-green-900/30 p-3 rounded-lg",children:[a.jsxs("div",{className:"text-xs text-green-900 dark:text-green-100",children:["Writes (",s,")"]}),a.jsx("div",{className:"text-lg font-semibold text-green-700 dark:text-green-200",children:t.writes.toLocaleString()})]}),a.jsxs("div",{className:"bg-purple-100 dark:bg-purple-900/30 p-3 rounded-lg",children:[a.jsxs("div",{className:"text-xs text-purple-900 dark:text-purple-100",children:["Bandwidth (",s,")"]}),a.jsx("div",{className:"text-lg font-semibold text-purple-700 dark:text-purple-200",children:(e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]})(t.bandwidth)})]})]})})(),B.projection&&null!==B.projection.daysUntilLimit&&a.jsxs("div",{className:"mb-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[a.jsx("div",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"Projection"}),a.jsx("div",{className:"text-lg font-bold text-yellow-600 dark:text-yellow-300",children:B.projection.daysUntilLimit>0?`${B.projection.daysUntilLimit} days until ${B.projection.limitInGB}GB limit reached`:"Bandwidth limit reached or exceeded!"}),a.jsx("div",{className:"text-xs text-yellow-600 dark:text-yellow-400",children:"Based on current daily average usage"})]}),S&&a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("h3",{className:"font-medium",children:"Daily Usage History (Last 30 Days)"}),a.jsx("button",{onClick:R,className:"text-sm px-3 py-1 bg-red-500 hover:bg-red-600 text-white rounded transition-colors",children:"Reset Data"})]}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:B.dailyUsage.length>0?a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[a.jsx("th",{className:"text-left py-2 px-2 text-gray-700 dark:text-gray-200",children:"Date"}),a.jsx("th",{className:"text-right py-2 px-2 text-gray-700 dark:text-gray-200",children:"Reads"}),a.jsx("th",{className:"text-right py-2 px-2 text-gray-700 dark:text-gray-200",children:"Writes"}),a.jsx("th",{className:"text-right py-2 px-2 text-gray-700 dark:text-gray-200",children:"Bandwidth"})]})}),a.jsx("tbody",{children:[...B.dailyUsage].reverse().map((e,t)=>a.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[a.jsx("td",{className:"py-2 px-2",children:e.date}),a.jsx("td",{className:"text-right py-2 px-2",children:e.reads.toLocaleString()}),a.jsx("td",{className:"text-right py-2 px-2",children:e.writes.toLocaleString()}),a.jsx("td",{className:"text-right py-2 px-2",children:(()=>{const t=e.bandwidth;if(0===t)return"0 Bytes";const a=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,a)).toFixed(2))+" "+["Bytes","KB","MB","GB"][a]})()})]},t))})]}):a.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"No usage data available"})})]}),a.jsxs("div",{className:"mt-4 text-sm text-gray-700 dark:text-gray-200",children:[a.jsxs("p",{children:["Budget: ",a.jsx("span",{className:"font-medium",children:"$25/month (~35GB)"}),". Current usage: ",a.jsx("span",{className:"font-semibold",children:B.totalBandwidthFormatted}),"."]}),a.jsx("p",{className:"mt-1",children:"Monitor this panel to ensure you stay within your Firebase plan limits."})]})]});i.useEffect(()=>{const e=t(s,e=>{w(e)});return()=>e()},[]),i.useEffect(()=>{if(y){const e=n(d,"templates"),t=o(e,e=>{const t=e.val(),a=t?Object.keys(t).map(e=>({id:e,...t[e]})):[];p(a)});return()=>t()}},[y]);const W=async e=>{e.preventDefault(),U(!0),L("");try{await r(s,j,N),g&&g()}catch(t){L("Login failed: "+(t.message||t.code))}finally{U(!1)}};return y?m?null:a.jsxs("div",{className:"container mx-auto p-4 max-w-6xl",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Admin Panel"}),a.jsx("button",{onClick:async()=>{await l(s)},className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors",children:"Logout"})]}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8",children:[a.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Upload New Template"}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[a.jsx("input",{type:"file",onChange:e=>{u(e.target.files[0])},className:"flex-grow p-2 border rounded bg-white dark:bg-gray-700 dark:border-gray-600",accept:"image/*"}),a.jsx("button",{onClick:async()=>{if(h)if(h.size>204800)try{const e=await function(e,{maxWidth:t=600,maxHeight:a=600,quality:s=.82}={}){return new Promise((r,l)=>{const d=new FileReader;d.onload=e=>{const d=new window.Image;d.onload=()=>{let{width:e,height:l}=d,i=Math.min(t/e,a/l,1);e=Math.round(e*i),l=Math.round(l*i);const n=document.createElement("canvas");n.width=e,n.height=l,n.getContext("2d").drawImage(d,0,0,e,l);let o="image/webp";n.toDataURL("image/webp").startsWith("data:image/webp")||(o="image/jpeg");const c=n.toDataURL(o,s);r(c)},d.onerror=l,d.src=e.target.result},d.onerror=l,d.readAsDataURL(e)})}(h,{maxWidth:600,maxHeight:600,quality:.82}),t=n(d,"templates");c(t,{name:h.name,url:e}),alert("Template auto-compressed and uploaded successfully!"),u(null)}catch(e){alert("Failed to compress image: "+e.message)}else{const e=new FileReader;e.onload=e=>{const t=e.target.result,a=n(d,"templates");c(a,{name:h.name,url:t}),alert("Template uploaded successfully!"),u(null)},e.readAsDataURL(h)}},disabled:!h||M,className:"px-4 py-2 rounded font-medium transition-colors "+(h?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"),children:M?"Uploading...":"Upload Template"})]})]}),a.jsx(E,{}),a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6",children:[a.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Manage Templates"}),0===b.length?a.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No templates found"}):a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:b.map(e=>a.jsxs("div",{className:"border dark:border-gray-700 rounded-lg overflow-hidden hover:shadow-md transition-shadow",children:[a.jsx("div",{className:"aspect-square bg-gray-100 dark:bg-gray-700 flex items-center justify-center p-2",children:a.jsx("img",{src:e.url,alt:e.name,className:"max-h-48 max-w-full object-contain"})}),a.jsx("div",{className:"p-3",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.name}),a.jsx("button",{onClick:()=>{window.confirm("Are you sure you want to delete this template?")&&(e=>{const t=n(d,`templates/${e}`);x(t)})(e.id)},className:"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 transition-colors",title:"Delete template",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},e.id))})]})]}):a.jsxs("form",{onSubmit:W,className:"w-full",children:[v&&a.jsx("div",{className:"text-red-500 dark:text-red-400 mb-4 text-center",children:v}),a.jsx("div",{className:"mb-4",children:a.jsx("input",{type:"email",value:j,onChange:e=>f(e.target.value),placeholder:"Email",className:"w-full p-2 border rounded bg-white dark:bg-gray-700 dark:border-gray-600 text-gray-900 dark:text-white",required:!0})}),a.jsx("div",{className:"mb-6",children:a.jsx("input",{type:"password",value:N,onChange:e=>k(e.target.value),placeholder:"Password",className:"w-full p-2 border rounded bg-white dark:bg-gray-700 dark:border-gray-600 text-gray-900 dark:text-white",required:!0})}),a.jsx("button",{type:"submit",className:"w-full bg-blue-500 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors",disabled:M,children:M?"Logging in...":"Login"})]})};export{m as default};
