import{d as e,j as t}from"./index-CyZx3RiQ.js";import{A as a,B as s,D as r,G as n,M as o,Q as l,P as c}from"./firebase-DOVT3bkn.js";import"./vendor-Cg3t72uT.js";const i=new class{constructor(e=18e4){this.cache=new Map,this.defaultTTL=e}set(e,t,a=this.defaultTTL){const s=Date.now()+a;this.cache.set(e,{data:t,expiresAt:s,createdAt:Date.now()})}get(e){const t=this.cache.get(e);return t?Date.now()>t.expiresAt?(this.cache.delete(e),null):t.data:null}has(e){return null!==this.get(e)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}getStats(){const e=Date.now();let t=0,a=0;return this.cache.forEach(s=>{e>s.expiresAt?a++:t++}),{totalEntries:this.cache.size,validEntries:t,expiredEntries:a}}cleanup(){const e=Date.now(),t=[];return this.cache.forEach((a,s)=>{e>a.expiresAt&&t.push(s)}),t.forEach(e=>this.cache.delete(e)),t.length}};async function d(t){var r;const n=a(e,"memes"),l=c(n);if(await o(l,{...t,upvotes:0,upvotedBy:{}}),t.templateId){const n=a(e,`templateUsage/${t.templateId}`);await o(n,{lastUsed:Date.now(),usageCount:(null==(r=(await s(n)).val())?void 0:r.usageCount)+1||1})}return l.key}async function m(t,r){try{const n=a(e,`memes/${t}`),l=await s(n);if(!l.exists())return!1;const c=l.val();return(!c.upvotedBy||!c.upvotedBy[r])&&(await o(n,{upvotes:(c.upvotes||0)+1,[`upvotedBy/${r}`]:!0}),!0)}catch(n){throw n}}async function h(t=20,r=!1){const n=`top-memes-${t}`;if(!r){const e=i.get(n);if(e)return e}try{const r=a(e,"memes"),o=await s(r),l=[];o.forEach(e=>{const t={id:e.key,...e.val()};l.push(t)}),l.sort((e,t)=>(t.upvotes||0)-(e.upvotes||0));const c=l.slice(0,t);return i.set(n,c,12e4),c}catch(o){throw o}}async function u(t,o=10){const l=r(a(e,"memes"),n("templateId")),c=await s(l),i=[];return c.forEach(e=>{const a=e.val();if(a.templateId===t){if("number"!=typeof a.upvotes||!a.templateId||!a.templateName||!a.createdAt)return;i.push({id:e.key,...a})}}),i.sort((e,t)=>t.createdAt-e.createdAt),i.slice(0,o)}async function x(t){const s=a(e,`memes/${t}`);await l(s)}function p({upvotes:e=0,hasUpvoted:a=!1,onUpvote:s,disabled:r=!1,size:n="md"}){return t.jsxs("div",{className:"flex flex-col items-center gap-1",children:[t.jsx("button",{onClick:s,disabled:r||a,className:`\n          ${{sm:"w-6 h-6 text-xs",md:"w-8 h-8 text-sm",lg:"w-10 h-10 text-base"}[n]} \n          flex items-center justify-center rounded-full border-2 transition-all duration-200\n          ${a?"bg-orange-500 border-orange-500 text-white shadow-md":"bg-white border-gray-300 text-gray-600 hover:border-orange-400 hover:text-orange-500 hover:bg-orange-50"}\n          ${r?"opacity-50 cursor-not-allowed":"cursor-pointer hover:scale-105"}\n        `,title:a?"You upvoted this meme":"Upvote this meme",children:t.jsx("svg",{className:{sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"}[n],fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z",clipRule:"evenodd"})})}),t.jsx("span",{className:`font-semibold ${a?"text-orange-600":"text-gray-700"} ${"sm"===n?"text-xs":"lg"===n?"text-base":"text-sm"}`,children:e})]})}function g({meme:e,isOpen:a,onClose:s,onUpvote:r,canUpvote:n,onDelete:o,canDelete:l}){if(!a||!e)return null;return t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&s()},children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-2xl max-h-[90vh] overflow-auto shadow-xl",children:[t.jsxs("div",{className:"flex justify-between items-center p-4 border-b dark:border-gray-700",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Meme Details"}),t.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl leading-none","aria-label":"Close modal",children:"Ã—"})]}),t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"mb-4 text-center",children:t.jsx("img",{src:e.imgDataUrl,alt:"Meme",className:"max-w-full max-h-96 mx-auto rounded border dark:border-gray-600 shadow-sm",style:{objectFit:"contain"}})}),t.jsxs("div",{className:"space-y-2 mb-4",children:[e.discordUsername&&t.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Created by:"})," @",e.discordUsername]}),t.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[t.jsx("span",{className:"font-medium",children:"Created:"})," ",new Date(e.createdAt).toLocaleString()]})]}),t.jsxs("div",{className:"flex gap-3 justify-center items-center",children:[t.jsx(p,{upvotes:e.upvotes||0,hasUpvoted:!n,onUpvote:()=>r(e.id),disabled:!n,size:"lg"}),l&&t.jsxs("button",{onClick:()=>o(e.id),className:"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",viewBox:"0 0 20 20",fill:"currentColor",children:t.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9zM4 5a2 2 0 012-2h8a2 2 0 012 2v6a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 102 0v3a1 1 0 11-2 0V9zm4 0a1 1 0 10-2 0v3a1 1 0 102 0V9z",clipRule:"evenodd"})}),"Delete"]})]})]})]})})}setInterval(()=>{i.cleanup()},3e5);const v="/assets/logo-fmo-MDi0.png";export{g as M,p as U,h as a,x as d,u as g,v as l,d as s,m as u};
