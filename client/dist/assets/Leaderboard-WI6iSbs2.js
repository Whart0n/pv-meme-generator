import{j as e,o as t,a}from"./index-CyZx3RiQ.js";import{r as s}from"./vendor-Cg3t72uT.js";import{a as r,l,U as n,M as i,u as o,d}from"./logo-BWROdrKM.js";import"./firebase-DOVT3bkn.js";import"./utils-CrM1Z76V.js";const c=({src:t,alt:a,className:r="",onClick:l,title:n,compressionQuality:i=.7,maxWidth:o=400,maxHeight:d=400,...c})=>{const[m,x]=s.useState(null),[g,h]=s.useState(!0),[u,p]=s.useState(!1),b=s.useRef(null);s.useRef(null);s.useEffect(()=>{if(!t)return;(async()=>{try{if(h(!0),p(!1),t.startsWith("data:image/")){const a=await(e=t,new Promise(t=>{const a=new Image;a.onload=()=>{const e=document.createElement("canvas"),s=e.getContext("2d");let{width:r,height:l}=a;if(r>o||l>d){const e=Math.min(o/r,d/l);r*=e,l*=e}e.width=r,e.height=l,s.drawImage(a,0,0,r,l);const n=e.toDataURL("image/jpeg",i);t(n)},a.src=e}));x(a)}else x(t)}catch(a){p(!0),x(t)}finally{h(!1)}var e})()},[t,i,o,d]);return u?e.jsx("div",{className:`flex items-center justify-center bg-gray-200 dark:bg-gray-700 ${r}`,children:e.jsx("div",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Failed to load image"})}):e.jsxs("div",{className:"relative",children:[g&&e.jsx("div",{className:`absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-800 ${r}`,children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"})}),m&&e.jsx("img",{ref:b,src:m,alt:a,className:`${r} ${g?"opacity-0":"opacity-100"} transition-opacity duration-300`,onClick:l,title:n,onLoad:()=>{h(!1),p(!1)},onError:()=>{h(!1),p(!0)},loading:"lazy",...c})]})};function m(){const[m,x]=s.useState([]),[g,h]=s.useState(!0),[u,p]=s.useState(""),b=(()=>{let e=localStorage.getItem("pv-meme-session-id");return e||(e=Math.random().toString(36).slice(2)+Date.now(),localStorage.setItem("pv-meme-session-id",e)),e})(),[v,f]=s.useState(null),[j,y]=s.useState(""),[N,w]=s.useState(null),[k,S]=s.useState(!1),[C,M]=s.useState(!1),{visibleItems:L,hasMore:B,loading:U,loadMore:D}=((e,t=10,a=5)=>{const[r,l]=s.useState([]),[n,i]=s.useState(!1),[o,d]=s.useState(!1),c=s.useRef(0);s.useEffect(()=>{if(0===e.length)return l([]),i(!1),void(c.current=0);const a=e.slice(0,t);l(a),c.current=a.length,i(e.length>t)},[e,t]);const m=s.useCallback(()=>{!o&&n&&(d(!0),setTimeout(()=>{const t=c.current,s=e.slice(t,t+a);l(e=>[...e,...s]),c.current=t+s.length,i(t+s.length<e.length),d(!1)},100))},[e,a,o,n]);return{visibleItems:r,hasMore:n,loading:o,loadMore:m,totalItems:e.length,loadedCount:c.current}})(m,8,4);s.useEffect(()=>{const e=t(a,f);return()=>e()},[]);const E=s.useCallback(async(e=!1)=>{try{e?M(!0):h(!0),p("");const t=(await r(50,e)).filter(e=>e.imgDataUrl&&e.imgDataUrl.length>0&&e.imgDataUrl.startsWith("data:image/"));x(t)}catch(t){p("Failed to load leaderboard.")}finally{h(!1),M(!1)}},[]);s.useEffect(()=>{E()},[E]);const H=async e=>{y("");const t=Date.now();if(t-Number(localStorage.getItem("pv-meme-last-upvote")||0)<5e3)y("You can only upvote once every 5 seconds. Please wait before upvoting again.");else try{await o(e,b);localStorage.setItem("pv-meme-last-upvote",t.toString()),x(t=>t.map(t=>{if(t.id===e){return{...t,upvotes:(t.upvotes||0)+1,upvotedBy:{...t.upvotedBy||{},[b]:!0}}}return t}))}catch(a){p("Failed to upvote. Please try again.")}},I=async e=>{await d(e),x(t=>t.filter(t=>t.id!==e)),S(!1)};return e.jsxs("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx("header",{className:"bg-gray-800 text-white p-4 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("img",{src:l,alt:"2.0 Logo",className:"h-10 w-10"}),e.jsx("h1",{className:"text-3xl font-bold",children:"PV Meme Generator"})]})}),e.jsx("main",{className:"p-4 md:p-6",children:e.jsx("div",{className:"container mx-auto",children:e.jsxs("div",{className:"max-w-3xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"🏆 Meme Leaderboard"}),e.jsxs("button",{onClick:()=>{E(!0)},disabled:C,className:"flex items-center gap-2 px-3 py-2 text-sm bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg transition-colors",title:"Refresh leaderboard",children:[e.jsx("svg",{className:"w-4 h-4 "+(C?"animate-spin":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),C?"Refreshing...":"Refresh"]})]}),j&&e.jsx("div",{className:"text-red-500 text-center mb-2",children:j}),g?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading leaderboard..."})]}):u?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-500 mb-4",children:u}),e.jsx("button",{onClick:()=>E(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Try Again"})]}):0===m.length?e.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-center py-8",children:"No memes found."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:L.map((t,a)=>e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-500 dark:text-gray-400 w-8",children:["#",a+1]}),e.jsx(n,{upvotes:t.upvotes||0,isUpvoted:t.upvotedBy&&t.upvotedBy[b]||!1,onClick:()=>H(t.id)}),e.jsx(c,{src:t.imgDataUrl,alt:"Meme",className:"w-24 h-24 object-cover rounded border cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>(e=>{w(e),S(!0)})(t),title:"Click to view full size",compressionQuality:.8,maxWidth:200,maxHeight:200}),e.jsxs("div",{className:"flex-1",children:[t.discordUsername&&e.jsxs("div",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:["@",t.discordUsername]}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Created: ",new Date(t.createdAt).toLocaleString()]})]}),v&&e.jsxs("button",{onClick:()=>I(t.id),className:"flex items-center gap-1 text-xs px-2 py-1 rounded bg-red-100 hover:bg-red-200 text-red-700 dark:bg-red-900 dark:text-red-300 dark:hover:bg-red-800",title:"Delete this meme",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 013-3h5a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V3a1 1 0 016 0v1a1 1 0 001 1v1m0 0a1 1 0 001 1v1a1 1 0 001 1V4a1 1 0 001-1h5a1 1 0 001-1V2a1 1 0 001 1H10z"})}),"Delete"]})]},t.id))}),B&&e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{onClick:D,disabled:U,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-lg transition-colors flex items-center gap-2 mx-auto",children:U?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Loading more..."]}):e.jsxs(e.Fragment,{children:["Load More Memes",e.jsxs("span",{className:"text-sm opacity-75",children:["(",m.length-L.length," remaining)"]})]})})}),e.jsxs("div",{className:"text-center mt-4 text-sm text-gray-500 dark:text-gray-400",children:["Showing ",L.length," of ",m.length," memes"]})]})]})})}),e.jsxs("footer",{className:"mt-12 py-6 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 text-center text-gray-700 dark:text-gray-300 text-sm",children:[e.jsx("div",{className:"mb-2 font-semibold text-base text-gray-800 dark:text-gray-100",children:"Your Tips Help Support This Site!"}),e.jsxs("div",{className:"flex flex-col items-center gap-1 mb-2",children:[e.jsxs("span",{children:[e.jsx("span",{className:"font-bold",children:"SOL:"})," E7AUwAjXoacTSrqKMg5Ycnwhn6boMbc8tpEhbrKUviAw"]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-bold",children:"ETH:"})," 0xd919d5304BE87E3159f6b1Cbd5516822F407B6eC"]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-bold",children:"BTC:"})," bc1qs8nrgl4h3u0gje0acaufpufmumvxql7cvgfhej"]})]}),e.jsx("div",{className:"flex justify-center items-center gap-2 mt-2",children:e.jsxs("a",{href:"https://x.com/ruffriderx",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1200 1227",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M1199.6 0 741 555.7 1199.6 1227H872.9L563.4 792.8 214.2 1227H0l485.8-594.7L43.6 0h337.7l261.2 366.2L985.8 0h213.8ZM917.7 1106.6h109.6L293.4 120.4h-114L917.7 1106.6Z"})}),e.jsx("span",{children:"Follow me on X"})]})})]}),N&&e.jsx(i,{isOpen:k,onClose:()=>{S(!1),w(null)},meme:N,onUpvote:async e=>{await H(e);const t=m.find(t=>t.id===e);t&&w(t)},upvotedMemes:e=>e.upvotedBy&&e.upvotedBy[b]||!1,isAdmin:v,onDelete:I})]})}export{m as default};
