import{j as e,d as t,o as r,a}from"./index-CyZx3RiQ.js";import{r as s,R as l}from"./vendor-Cg3t72uT.js";import{A as n,B as o}from"./firebase-DOVT3bkn.js";import{g as i,M as d,u as c,d as m,s as g,l as u}from"./logo-BWROdrKM.js";import{F as x}from"./utils-CrM1Z76V.js";const h=({onSelect:r,selectedTemplate:a,onTemplatesLoaded:l})=>{const[i,d]=s.useState([]),[c,m]=s.useState(!0),[g,u]=s.useState(new Set),x=s.useCallback(e=>{u(t=>new Set([...t,e]))},[]);return s.useEffect(()=>{(async()=>{m(!0);try{const e=await async function(){try{const e=n(t,"templates"),r=await o(e),a=[];if(r.exists()){const e=r.val();let t=0,s=0;for(const r in e){const l=e[r];l&&l.url?(a.push({id:r,...l,src:l.url,order:l.order||9999}),t++):s++}a.sort((e,t)=>(e.order||9999)-(t.order||9999))}return a}catch(e){return[]}}();d(e),l&&l(e)}catch(e){d(templatesWithSrc)}m(!1)})()},[l]),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"overflow-y-auto p-2 border dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 scrollbar-thin scrollbar-thumb-gray-400 dark:scrollbar-thumb-gray-500 scrollbar-track-gray-200 dark:scrollbar-track-gray-800",style:{scrollbarColor:"#a0aec0 #edf2f7",scrollbarWidth:"thin",height:"360px",minHeight:"360px",maxHeight:"400px"},children:c?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Loading templates..."})}):i.length>0?e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2",children:i.map(t=>e.jsxs("div",{className:`cursor-pointer border-4 ${(null==a?void 0:a.id)===t.id?"border-blue-500 dark:border-blue-400":"border-transparent"} rounded-lg overflow-hidden aspect-square flex items-center justify-center bg-gray-200 dark:bg-gray-600 relative`,onClick:()=>r(t),children:[!g.has(t.id)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-300 dark:bg-gray-600",children:e.jsx("div",{className:"w-6 h-6 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"})}),e.jsx("img",{src:t.src,alt:t.name,className:"w-full h-full object-cover transition-opacity duration-300 "+(g.has(t.id)?"opacity-100":"opacity-0"),loading:"lazy",onLoad:()=>x(t.id),onError:e=>{e.target.style.display="none",x(t.id)}})]},t.id))}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No templates found."})})}),i.length>6&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-gray-50 dark:from-gray-700 to-transparent pointer-events-none rounded-b-lg",children:e.jsxs("div",{className:"absolute bottom-1 left-1/2 transform -translate-x-1/2 flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"w-3 h-3 animate-bounce",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})}),e.jsx("span",{children:"Scroll for more"})]})})]})};function b({templateId:t}){const[l,n]=s.useState([]),[o,g]=s.useState(!1),[u,x]=s.useState(""),h=(()=>{let e=localStorage.getItem("pv-meme-session-id");return e||(e=Math.random().toString(36).slice(2)+Date.now(),localStorage.setItem("pv-meme-session-id",e)),e})(),[b,p]=s.useState(null),[f,y]=s.useState(""),[v,j]=s.useState(null),[k,w]=s.useState(!1),[N,S]=s.useState(new Set),C=s.useCallback(e=>{S(t=>new Set([...t,e]))},[]);s.useEffect(()=>{const e=r(a,p);return()=>e()},[]),s.useEffect(()=>{t&&(g(!0),i(t,10).then(e=>{n(e),x("")}).catch(()=>x("Failed to load recent memes.")).finally(()=>g(!1)))},[t]);const F=async e=>{y("");const t=Date.now();t-Number(localStorage.getItem("pv-meme-last-upvote")||0)<5e3?y("You can only upvote once every 5 seconds. Please wait before upvoting again."):(await c(e,h),localStorage.setItem("pv-meme-last-upvote",t.toString()),n(t=>t.map(t=>t.id===e?{...t,upvotes:(t.upvotes||0)+1}:t)))},A=async e=>{await m(e),n(t=>t.filter(t=>t.id!==e)),w(!1)};return t?e.jsxs("div",{className:"mt-6 bg-gray-50 dark:bg-gray-800 border dark:border-gray-700 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3 text-gray-900 dark:text-white",children:"Recently Created Memes"}),f&&e.jsx("div",{className:"text-red-500 text-center mb-2",children:f}),o?e.jsx("p",{className:"text-gray-400 dark:text-gray-500",children:"Loading..."}):0===l.length?e.jsx("p",{className:"text-gray-400 dark:text-gray-500",children:"No recent memes for this template yet."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:l.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded shadow p-2 flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-full h-24 mb-2",children:[!N.has(t.id)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-200 dark:bg-gray-600 rounded",children:e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"})}),e.jsx("img",{src:t.imgDataUrl,alt:"User Meme",className:"w-full h-24 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity "+(N.has(t.id)?"opacity-100":"opacity-0"),loading:"lazy",onClick:()=>(e=>{j(e),w(!0)})(t),onLoad:()=>C(t.id),onError:()=>C(t.id),title:"Click to view full size"})]}),e.jsxs("button",{onClick:()=>F(t.id),className:"flex items-center gap-1 text-xs px-2 py-1 rounded bg-blue-100 hover:bg-blue-200 text-blue-700",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M3 10a7 7 0 1114 0A7 7 0 013 10zm7-3a1 1 0 00-1 1v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V8a1 1 0 00-1-1z"})}),"Upvote (",t.upvotes||0,")"]}),b&&e.jsx("button",{onClick:()=>A(t.id),className:"mt-2 bg-red-100 hover:bg-red-200 text-red-700 text-xs px-2 py-1 rounded",title:"Delete meme (admin only)",children:"Delete"})]},t.id))}),u&&l.length>0&&e.jsx("p",{className:"text-red-500",children:u}),e.jsx(d,{meme:v,isOpen:k,onClose:()=>{w(!1),j(null)},onUpvote:async e=>{await F(e);const t=l.find(t=>t.id===e);t&&j(t)},canUpvote:v&&(!v.upvotedBy||!v.upvotedBy[h]),onDelete:A,canDelete:b})]}):null}const p=s.forwardRef((t,r)=>{const{templateUrl:a,textBoxes:l=[],images:n=[],selectedObjectId:o,onUpdateObject:i,onSelectObject:d,onReady:c}=t,m=s.useRef(null),g=s.useRef(null),u=s.useRef(null),h=s.useRef(null),b=s.useRef(null),p=s.useMemo(()=>((e,t)=>{let r;return function(...a){clearTimeout(r),r=setTimeout(()=>{clearTimeout(r),e(...a)},t)}})(()=>{const e=g.current;e&&e.renderAll()},16),[]);s.useEffect(()=>{const e=()=>document.documentElement.classList.contains("dark")?"#1f2937":"#f8f9fa",t=new window.fabric.Canvas(m.current,{backgroundColor:e(),preserveObjectStacking:!0});g.current=t;const r=new MutationObserver(r=>{for(let a of r)"attributes"===a.type&&"class"===a.attributeName&&t.setBackgroundColor(e(),t.renderAll.bind(t))});r.observe(document.documentElement,{attributes:!0});const a=e=>{var t,r;return d((null==(r=null==(t=e.selected)?void 0:t[0])?void 0:r.id)||null)};return t.on({"object:modified":e=>{const t=e.target;if(!t||!i)return;const r={left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,angle:t.angle};"textbox"===t.type&&(r.text=t.text),i(t.id,r),p()},"selection:created":a,"selection:updated":a,"selection:cleared":()=>d(null)}),()=>{r.disconnect(),t.dispose()}},[i,d]);const f=s.useCallback(()=>{const e=g.current;e&&(b.current&&e.remove(b.current),window.fabric.Image.fromURL("/assets/watermark-C2-fCc0B.png",t=>{const r=60/t.width;t.scale(r),t.set({selectable:!1,evented:!1,hasBorders:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,opacity:.5});(()=>{const r=e.getWidth(),a=e.getHeight();t.set({left:r-t.width*t.scaleX-10,top:a-t.height*t.scaleY-10})})(),b.current=t,e.add(t),t.moveTo(999),e.renderAll()},{crossOrigin:"anonymous"}))},[]);return s.useEffect(()=>{const e=g.current;e&&a&&(e.clear(),e.setBackgroundImage(null,e.renderAll.bind(e)),h.current=null,b.current=null,window.fabric.Image.fromURL(a,t=>{h.current=t;const r=u.current,a=r?r.clientWidth/t.width:1;e.setDimensions({width:t.width*a,height:t.height*a});const s=1.02*a;e.setBackgroundImage(t,e.renderAll.bind(e),{scaleX:s,scaleY:s,left:e.width/2,top:e.height/2,originX:"center",originY:"center",selectable:!1,evented:!1}),f(),c&&c()},{crossOrigin:"anonymous"}))},[a,c,f]),s.useEffect(()=>{const e=g.current,t=u.current;if(!e||!t)return;const r=new ResizeObserver(()=>{const r=h.current;if(r){const a=t.clientWidth/r.width;e.setDimensions({width:r.width*a,height:r.height*a});const s=e.backgroundImage;if(s){const t=1.02*a;s.set({scaleX:t,scaleY:t,left:e.width/2,top:e.height/2,originX:"center",originY:"center"})}(()=>{if(!b.current)return;const t=b.current,r=e.getWidth(),a=e.getHeight();t.set({left:r-t.width*t.scaleX-10,top:a-t.height*t.scaleY-10})})(),e.renderAll()}});return r.observe(t),()=>r.disconnect()},[]),s.useEffect(()=>{const e=g.current;if(!e)return;const t=[...l,...n],r=e.getObjects().filter(e=>e.id).map(e=>e.id),a=t.map(e=>e.id);r.filter(e=>!a.includes(e)).forEach(t=>{const r=e.getObjects().find(e=>e.id===t);r&&e.remove(r)}),t.forEach(t=>{const r=e.getObjects().find(e=>e.id===t.id);if(r){const e={};if(void 0!==t.text){const a=t.allCaps?t.text.toUpperCase():t.text;r.text!==a&&(e.text=a),r.fontFamily!==t.fontFamily&&(e.fontFamily=t.fontFamily),r.fontSize!==t.fontSize&&(e.fontSize=t.fontSize),r.fill!==t.color&&(e.fill=t.color),r.stroke!==t.stroke&&(e.stroke=t.stroke),r.strokeWidth!==t.strokeWidth&&(e.strokeWidth=t.strokeWidth),r.textAlign!==t.textAlign&&(e.textAlign=t.textAlign)}Object.keys(e).length>0&&r.set(e)}else if(void 0!==t.text){const{color:r,allCaps:a,...s}=t,l=a?t.text.toUpperCase():t.text,n=new window.fabric.Textbox(l,{...s,fill:r,borderColor:"#2B95D6",cornerColor:"#2B95D6"});e.add(n)}else window.fabric.Image.fromURL(t.src,r=>{r.set({...t,borderColor:"#2B95D6",cornerColor:"#2B95D6"}),e.add(r)},{crossOrigin:"anonymous"})}),e.renderAll()},[l,n]),s.useEffect(()=>{var e;const t=g.current;if(!t)return;if((null==(e=t.getActiveObject())?void 0:e.id)!==o){const e=t.getObjects().find(e=>e.id===o);e?t.setActiveObject(e):t.discardActiveObject(),t.renderAll()}},[o]),s.useImperativeHandle(r,()=>({handleExport:()=>{const e=g.current;if(e)try{e.discardActiveObject(),e.renderAll();const t=e.toDataURL({format:"png",quality:1,multiplier:2}),r=`meme-${(new Date).toISOString().slice(0,19).replace(/:/g,"-")}.png`;x.saveAs(t,r)}catch(t){}},handleExportAndGetDataUrl:()=>{const e=g.current;if(!e)return null;try{return e.discardActiveObject(),e.renderAll(),e.toDataURL({format:"png",quality:1,multiplier:2})}catch(t){return null}}})),e.jsx("div",{className:"relative w-full h-auto rounded-lg overflow-hidden",ref:u,children:e.jsx("canvas",{ref:m})})}),f=["Impact","Arial Black","Arial","Helvetica","Comic Sans MS","Montserrat","Open Sans","Roboto","Lato","Source Sans Pro","Nunito","Poppins","Oswald","Raleway","Ubuntu","Merriweather Sans","PT Sans","Dosis","Cabin","Quicksand","Times New Roman","Times","Georgia","Merriweather","Playfair Display","Lora","PT Serif","Crimson Text","Libre Baskerville","Courier New","Monaco","Consolas","Source Code Pro","Roboto Mono","Inconsolata","Bebas Neue","Anton","Righteous","Fredoka One","Bangers","Creepster","Bungee","Permanent Marker","Kalam","Architects Daughter","Amatic SC","Indie Flower","Shadows Into Light","Dancing Script","Pacifico","Lobster","Great Vibes","Arial Narrow","Trebuchet MS","Verdana","Tahoma","Century Gothic","Franklin Gothic Medium","Lucida Console","Palatino","Book Antiqua","MS Sans Serif"],y=["#FFFFFF","#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF"];function v({selectedTextBox:t,isObjectSelected:r,onUpdate:a,onAdd:s,onRemove:n,onExport:o,isLoading:i,onAddImage:d}){const c=l.useRef(null),m=(e,r)=>{t&&a(t.id,{[e]:r})};return e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-lg mb-4 text-gray-900 dark:text-white",children:"Controls"}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("button",{onClick:s,className:"bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 text-white font-medium py-2 px-4 rounded w-full",children:"Add Text Box"}),e.jsx("button",{onClick:()=>{var e;return null==(e=c.current)?void 0:e.click()},className:"bg-purple-500 hover:bg-purple-600 dark:bg-purple-600 dark:hover:bg-purple-700 text-white font-medium py-2 px-4 rounded w-full",children:"Add Image"}),e.jsx("input",{type:"file",ref:c,className:"hidden",accept:"image/*",onChange:e=>{const t=e.target.files[0];t&&d(t),e.target.value=null}})]}),r?t?e.jsxs("div",{className:"space-y-4 pt-4 border-t dark:border-gray-600",children:[e.jsx("h4",{className:"font-medium text-md mb-2 text-gray-900 dark:text-white",children:"Edit Selected Text"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Text"}),e.jsx("textarea",{value:t.text,onChange:e=>m("text",e.target.value),className:"w-full border p-2 rounded mt-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600",rows:"3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Font"}),e.jsx("select",{value:t.fontFamily,onChange:e=>m("fontFamily",e.target.value),className:"w-full border p-2 rounded mt-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600",style:{fontFamily:t.fontFamily},children:f.map(t=>e.jsx("option",{value:t,style:{fontFamily:t},children:t},t))}),e.jsxs("div",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["Preview: ",e.jsx("span",{style:{fontFamily:t.fontFamily,fontSize:"14px",fontWeight:"bold"},children:"Sample Text"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Font Size"}),e.jsx("input",{type:"number",value:t.fontSize,onChange:e=>m("fontSize",parseInt(e.target.value,10)||10),className:"w-full border p-2 rounded mt-1 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 dark:border-gray-600"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Color"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[y.map(r=>e.jsx("div",{onClick:()=>m("color",r),className:"w-6 h-6 rounded-full cursor-pointer border-2 "+(t.color.toLowerCase()===r.toLowerCase()?"border-blue-500 dark:border-blue-400":"border-transparent"),style:{backgroundColor:r}},r)),e.jsx("input",{type:"color",value:t.color,onChange:e=>m("color",e.target.value),className:"w-8 h-8 p-0 border-none rounded-full cursor-pointer bg-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Alignment"}),e.jsx("div",{className:"flex items-center justify-between gap-2 mt-1 rounded-md bg-gray-100 dark:bg-gray-700 p-1",children:["left","center","right"].map(r=>e.jsx("button",{onClick:()=>m("textAlign",r),className:"flex-1 py-1 px-2 text-sm rounded-md transition-colors duration-200 "+(t.textAlign===r?"bg-blue-500 text-white":"bg-transparent text-gray-600 hover:bg-gray-200 dark:text-gray-300 dark:hover:bg-gray-600"),children:r.charAt(0).toUpperCase()+r.slice(1)},r))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Text Style"}),e.jsx("div",{className:"flex items-center gap-3 mt-1",children:e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.allCaps||!1,onChange:e=>m("allCaps",e.target.checked),className:"sr-only"}),e.jsx("div",{className:"relative w-10 h-6 rounded-full transition-colors duration-200 "+(t.allCaps?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"),children:e.jsx("div",{className:"absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform duration-200 "+(t.allCaps?"translate-x-4":"translate-x-0")})}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"ALL CAPS"})]})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:["Stroke Width: ",t.strokeWidth]}),e.jsx("input",{type:"range",min:"0",max:"10",step:"0.5",value:t.strokeWidth,onChange:e=>m("strokeWidth",parseFloat(e.target.value)),className:"w-full mt-1"})]})]}):e.jsxs("div",{className:"space-y-4 pt-4 border-t dark:border-gray-600",children:[e.jsx("h4",{className:"font-medium text-md mb-2 text-gray-900 dark:text-white",children:"Edit Selected Image"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"Resize and move the image directly on the canvas."})]}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-4 text-center",children:"Select an object on the canvas to edit it."}),r&&e.jsx("div",{className:"pt-4 border-t dark:border-gray-600",children:e.jsx("button",{onClick:n,className:"bg-red-500 hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 text-white font-medium py-2 px-4 rounded w-full",children:"Remove Selected Object"})})]})}function j({fabricCanvasRef:t,selectedTemplate:r}){const[a,l]=s.useState(!1),[n,o]=s.useState(""),[i,d]=s.useState("");return e.jsxs("div",{className:"flex flex-col items-end w-full gap-3",children:[e.jsxs("div",{className:"flex flex-col items-end gap-2 w-full",children:[e.jsx("input",{type:"text",placeholder:"Discord username (optional)",value:i,onChange:e=>d(e.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded text-sm w-64 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",maxLength:32}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800 text-white px-4 py-2 rounded shadow font-semibold disabled:opacity-60",onClick:async()=>{o("");const e=Date.now();if(e-Number(localStorage.getItem("pv-meme-last-created")||0)<6e4)o("You can only create one meme per minute. Please wait before creating another.");else if(t.current&&r){l(!0);try{const a=t.current.handleExportAndGetDataUrl();if(!a)throw alert("Export failed: Meme image dataUrl is blank or null."),new Error("Failed to export meme image.");const s={imgDataUrl:a,templateId:r.id,templateName:r.name||r.label||"",createdAt:Date.now(),discordUsername:i.trim()||null},l=await g(s);if(s.imgDataUrl||alert("imgDataUrl is missing before save!"),!l)return void alert("Error: Meme was not saved to the database.");if(!s.templateId||!s.templateName)return void alert("Error: Missing templateId or templateName. Meme will not appear in leaderboard/recent memes.");localStorage.setItem("pv-meme-last-created",e.toString());const n=`meme-${(new Date).toISOString().slice(0,19).replace(/:/g,"-")}.png`;x.saveAs(a,n),alert("Meme saved, shared, and downloaded as PNG! It will appear in Recent Memes and the Leaderboard.")}catch(a){o(a.message||"Failed to save meme.")}finally{l(!1)}}},disabled:a,children:a?"Saving...":"Save & Share Meme"})]}),n&&e.jsx("span",{className:"text-red-500 dark:text-red-400 text-xs mt-2",children:n})]})}function k(){const[t,r]=s.useState(null),[a,l]=s.useState(!0),[n,o]=s.useState([]),[i,d]=s.useState([]),[c,m]=s.useState(null),g=s.useRef(null),x=s.useCallback(e=>{l(!0),r(e),o([]),d([]),m(null)},[]),f=s.useCallback(e=>{e.length>0&&x(e[0])},[x]),y=s.useCallback(()=>{l(!1)},[]),k=s.useCallback((e,t)=>{o(r=>r.map(r=>r.id===e?{...r,...t}:r)),d(r=>r.map(r=>r.id===e?{...r,...t}:r))},[]),w=s.useCallback(e=>{m(e)},[]),N=[...n,...i].find(e=>e.id===c),S=N&&void 0!==N.text?N:null;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx("header",{className:"bg-gray-800 text-white p-4 shadow-md",children:e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("img",{src:u,alt:"2.0 Logo",className:"h-10 w-10"}),e.jsx("h1",{className:"text-3xl font-bold",children:"PV Meme Generator"})]})}),e.jsx("main",{className:"p-4 md:p-6",children:e.jsxs("div",{className:"container mx-auto",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2 text-gray-900 dark:text-white",children:["1. Select a Template ",e.jsx("span",{className:"text-base text-gray-400 dark:text-gray-500",children:"(scroll to see more)"})," ",e.jsx("svg",{className:"inline-block w-5 h-5 text-gray-400 dark:text-gray-500 animate-bounce",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]}),e.jsx(h,{onSelect:x,selectedTemplate:t,onTemplatesLoaded:f})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"2. Customize Your Meme"}),e.jsxs("div",{className:"relative min-h-[400px]",children:[a&&e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-center items-center bg-white dark:bg-gray-800 bg-opacity-80 z-10 rounded-lg",children:[e.jsx("div",{className:"loader ease-linear rounded-full border-8 border-t-8 border-gray-200 dark:border-gray-600 h-32 w-32 mb-4"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-lg",children:"Loading template..."})]}),e.jsx("div",{className:"meme-editor-container "+(a&&!t?"invisible":""),children:t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6",children:[e.jsx("div",{className:"md:col-span-3",children:e.jsx(p,{ref:g,templateUrl:t.src,textBoxes:n,images:i,selectedObjectId:c,onReady:y,onUpdateObject:k,onSelectObject:w})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(v,{selectedTextBox:S,isObjectSelected:!!c,onUpdate:k,onAdd:()=>{const e={id:`text-${Date.now()}`,text:"SAMPLE TEXT",fontFamily:"Impact",fontSize:40,color:"#FFFFFF",stroke:"#000000",strokeWidth:2,textAlign:"left",left:50,top:50,width:200,height:100,angle:0,scaleX:1,scaleY:1,allCaps:!0};o(t=>[...t,e]),m(e.id)},onRemove:()=>{c&&(o(e=>e.filter(e=>e.id!==c)),d(e=>e.filter(e=>e.id!==c)),m(null))},isLoading:a,onAddImage:e=>{const t=new FileReader;t.onload=e=>{const t={id:`image-${Date.now()}`,src:e.target.result,left:50,top:50,scaleX:.5,scaleY:.5,angle:0};d(e=>[...e,t]),m(t.id)},t.readAsDataURL(e)}})})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(j,{fabricCanvasRef:g,selectedTemplate:t})})]}):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-16",children:"Please select a template to start."})})]})]}),e.jsx(b,{templateId:null==t?void 0:t.id})]})}),e.jsxs("footer",{className:"mt-12 py-6 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 text-center text-gray-700 dark:text-gray-300 text-sm",children:[e.jsx("div",{className:"mb-2 font-semibold text-base text-gray-800 dark:text-gray-100",children:"Your Tips Help Support This Site!"}),e.jsxs("div",{className:"flex flex-col items-center gap-1 mb-2",children:[e.jsxs("span",{children:[e.jsx("span",{className:"font-bold",children:"SOL:"})," E7AUwAjXoacTSrqKMg5Ycnwhn6boMbc8tpEhbrKUviAw"]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-bold",children:"ETH:"})," 0xd919d5304BE87E3159f6b1Cbd5516822F407B6eC"]}),e.jsxs("span",{children:[e.jsx("span",{className:"font-bold",children:"BTC:"})," bc1qs8nrgl4h3u0gje0acaufpufmumvxql7cvgfhej"]})]}),e.jsx("div",{className:"flex justify-center items-center gap-2 mt-2",children:e.jsxs("a",{href:"https://x.com/ruffriderx",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1200 1227",className:"w-5 h-5",fill:"currentColor",children:e.jsx("path",{d:"M1199.6 0 741 555.7 1199.6 1227H872.9L563.4 792.8 214.2 1227H0l485.8-594.7L43.6 0h337.7l261.2 366.2L985.8 0h213.8ZM917.7 1106.6h109.6L293.4 120.4h-114L917.7 1106.6Z"})}),e.jsx("span",{children:"Follow me on X"})]})})]})]})})}export{k as default};
